<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignment 4: Enhanced GIS Map with Layer Controls</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2em;
        }
        
        .header p {
            margin: 0;
            opacity: 0.9;
        }
        
        #map { 
            height: 600px; 
            width: 100%; 
        }
        
        .info-panel {
            padding: 20px;
            background: #f8f9fa;
        }
        
        .legend {
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-top: 10px;
        }
        
        .legend h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        
        .legend-color {
            width: 20px;
            height: 3px;
            margin-right: 10px;
            border-radius: 2px;
        }
        
        .coordinates {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è Enhanced GIS Map with Layer Controls</h1>
            <p>Interactive map showing Sukabumi area with multiple base maps and overlay layers</p>
        </div>
        
        <div id="map"></div>
        <div id="coordinates" class="coordinates">Click on map to see coordinates</div>
        
        <div class="info-panel">
            <div class="legend">
                <h4>Map Features</h4>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c; width: 10px; height: 10px; border-radius: 50%;"></div>
                    <span>Important Locations (Markers)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #27ae60;"></div>
                    <span>Walking Route (Polyline)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(155, 89, 182, 0.5);"></div>
                    <span>Campus Area (Polygon)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f39c12; width: 10px; height: 10px; border-radius: 50%;"></div>
                    <span>Districts & Administrative Areas</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize map
        var map = L.map("map").setView([-6.9053877997992, 106.87356135956009], 15);

        // Base Maps
        var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        });

        var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles ¬© Esri ‚Äî Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
            maxZoom: 19
        });

        // Add default base map
        osmLayer.addTo(map);

        // Overlay Layers
        
        // 1. Markers Layer
        var markersLayer = L.layerGroup();
        var markerData = [
            {lat: -6.905526632682002, lng: 106.87460693244734, popup: 'üè† Home Residence', icon: 'home'},
            {lat: -6.905371637991479, lng: 106.87354867030655, popup: 'üéì NusaPutra Campus', icon: 'school'},
            {lat: -6.902595997614433, lng: 106.88374813225745, popup: 'üçû Vos Bakery', icon: 'store'},
            {lat: -6.902816971435422, lng: 106.8825460640145, popup: 'üè• Emergency Medical Clinic', icon: 'hospital'},
            {lat: -6.9192497, lng: 106.9289142, popup: 'üèõÔ∏è Sukabumi City Hall', icon: 'government'}
        ];

        // Custom marker icons
        var customIcons = {
            home: L.divIcon({className: 'custom-icon', html: 'üè†', iconSize: [30, 30]}),
            school: L.divIcon({className: 'custom-icon', html: 'üéì', iconSize: [30, 30]}),
            store: L.divIcon({className: 'custom-icon', html: 'üçû', iconSize: [30, 30]}),
            hospital: L.divIcon({className: 'custom-icon', html: 'üè•', iconSize: [30, 30]}),
            government: L.divIcon({className: 'custom-icon', html: 'üèõÔ∏è', iconSize: [30, 30]})
        };

        markerData.forEach(function(item) {
            var marker = L.marker([item.lat, item.lng], {
                icon: customIcons[item.icon] || L.marker().options.icon
            }).bindPopup(item.popup);
            markersLayer.addLayer(marker);
        });

        // 2. Polyline Layer (Walking Routes)
        var polylinesLayer = L.layerGroup();
        
        // Main walking route
        var walkingRoute = [
            [-6.902595997614433, 106.88374813225745], // Vos Bakery
            [-6.9053877997992, 106.87356135956009],   // NusaPutra Campus
            [-6.905526632682002, 106.87460693244734]  // Home
        ];
        
        var mainRoute = L.polyline(walkingRoute, {
            color: '#27ae60',
            weight: 4,
            opacity: 0.8
        }).bindPopup('üö∂ Main Walking Route: Bakery ‚Üí Campus ‚Üí Home');
        
        // Secondary route (example: to city hall)
        var secondaryRoute = [
            [-6.905526632682002, 106.87460693244734], // Home
            [-6.907000, 106.880000]                   // City Hall
        ];
        
        var cityRoute = L.polyline(secondaryRoute, {
            color: '#3498db',
            weight: 3,
            opacity: 0.7,
            dashArray: '10, 10'
        }).bindPopup('üèõÔ∏è Route to City Hall');
        
        polylinesLayer.addLayer(mainRoute);
        polylinesLayer.addLayer(cityRoute);

        // 3. Polygon Layer (Areas)
        var polygonsLayer = L.layerGroup();
        
        // Campus area
        var campusArea = [
            [-6.905521677411528, 106.87383568225783],
            [-6.904833465852192, 106.87372693873033], 
            [-6.9047659940766835, 106.87320134501283], 
            [-6.905616137743223, 106.87317415913208] 
        ];
        
        var campusPolygon = L.polygon(campusArea, {
            color: '#9b59b6',
            fillColor: '#e8d5f2',
            fillOpacity: 0.5,
            weight: 2
        }).bindPopup('üéì NusaPutra Campus Area');
        
        // Residential area
        var residentialArea = [
            [-6.904500, 106.873000],
            [-6.904000, 106.874000],
            [-6.905000, 106.875000],
            [-6.905500, 106.874000]
        ];
        
        var residentialPolygon = L.polygon(residentialArea, {
            color: '#e67e22',
            fillColor: '#f8e6d3',
            fillOpacity: 0.4,
            weight: 2
        }).bindPopup('üèòÔ∏è Residential Area');
        
        polygonsLayer.addLayer(campusPolygon);
        polygonsLayer.addLayer(residentialPolygon);

        // Enhanced GeoJSON data with Sukabumi district boundaries
        var sukabumiBoundaries = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {
                        "name": "Sukabumi Kabupaten District",
                        "type": "district",
                        "population": "350000"
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [[
                            [106.860000, -6.890000],
                            [106.890000, -6.890000],
                            [106.890000, -6.920000],
                            [106.860000, -6.920000],
                            [106.860000, -6.890000]
                        ]]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "name": "Gunungpuyuh Subdistrict",
                        "type": "subdistrict"
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [[
                            [106.870000, -6.900000],
                            [106.885000, -6.900000],
                            [106.885000, -6.910000],
                            [106.870000, -6.910000],
                            [106.870000, -6.900000]
                        ]]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "name": "Emergency Medical Center",
                        "type": "medical_facility"
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [106.8825460640145, -6.902816971435422]
                    }
                }
            ]
        };

        // Add GeoJSON layer
        var geoJsonLayer = L.geoJSON(sukabumiBoundaries, {
            style: function(feature) {
                if (feature.geometry.type === 'Polygon') {
                    return {
                        color: '#f39c12',
                        weight: 2,
                        opacity: 0.8,
                        fillColor: '#f9e79f',
                        fillOpacity: 0.3
                    };
                }
            },
            pointToLayer: function(feature, latlng) {
                if (feature.properties.type === 'medical_facility') {
                    return L.marker(latlng, {
                        icon: L.divIcon({
                            className: 'custom-icon',
                            html: 'üè•',
                            iconSize: [25, 25]
                        })
                    });
                }
            },
            onEachFeature: function(feature, layer) {
                if (feature.properties && feature.properties.name) {
                    var popupContent = "<strong>" + feature.properties.name + "</strong>";
                    if (feature.properties.type) {
                        popupContent += "<br>Type: " + feature.properties.type;
                    }
                    if (feature.properties.population) {
                        popupContent += "<br>Population: " + feature.properties.population;
                    }
                    layer.bindPopup(popupContent);
                }
            }
        });

        // Base Maps object
        var baseMaps = {
            "üó∫Ô∏è OpenStreetMap": osmLayer,
            "üõ∞Ô∏è Satellite": satelliteLayer
        };

        // Overlay Maps object
        var overlayMaps = {
            "üìç Markers": markersLayer,
            "üõ§Ô∏è Routes": polylinesLayer,
            "üèòÔ∏è Areas": polygonsLayer,
            "üó∫Ô∏è Districts": geoJsonLayer
        };

        // Add layers to map by default
        markersLayer.addTo(map);
        polylinesLayer.addTo(map);
        polygonsLayer.addTo(map);
        geoJsonLayer.addTo(map);

        // Layer Control
        var layerControl = L.control.layers(baseMaps, overlayMaps, {
            position: 'topright',
            collapsed: false
        }).addTo(map);

        // Scale Control
        L.control.scale({
            position: 'bottomright'
        }).addTo(map);

        // Coordinate display on click
        var coordsDiv = document.getElementById('coordinates');
        map.on('click', function(e) {
            var lat = e.latlng.lat.toFixed(6);
            var lng = e.latlng.lng.toFixed(6);
            coordsDiv.innerHTML = `üìç Coordinates: ${lat}, ${lng}`;
        });

        // Custom CSS for icons
        var style = document.createElement('style');
        style.textContent = `
            .custom-icon {
                background: white;
                border-radius: 50%;
                border: 2px solid #333;
                text-align: center;
                line-height: 26px;
                font-size: 16px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            }
            
            .leaflet-control-layers {
                max-height: 300px;
                overflow-y: auto;
            }
            
            .leaflet-popup-content {
                font-size: 14px;
                line-height: 1.4;
            }
        `;
        document.head.appendChild(style);

        // Fit map to show all features
        var group = new L.featureGroup([markersLayer, polylinesLayer, polygonsLayer, geoJsonLayer]);
        map.fitBounds(group.getBounds().pad(0.1));
    </script>
</body>
</html>