<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assignment 4: Enhanced GIS Map with Layer Controls</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2em;
        }
        
        .header p {
            margin: 0;
            opacity: 0.9;
        }
        
        #map { 
            height: 600px; 
            width: 100%; 
        }
        
        .info-panel {
            padding: 20px;
            background: #f8f9fa;
        }
        
        .legend {
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-top: 10px;
        }
        
        .legend h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        
        .legend-color {
            width: 20px;
            height: 3px;
            margin-right: 10px;
            border-radius: 2px;
        }
        
        .coordinates {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255,255,255,0.9);
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üó∫Ô∏è Enhanced GIS Map with Layer Controls</h1>
            <p>Interactive map showing Sukabumi area with multiple base maps and overlay layers</p>
        </div>
        
        <div id="map"></div>
        <div id="coordinates" class="coordinates">Click on map to see coordinates</div>
        
                <div class="info-panel">
            <div class="legend">
                <h4>Map Features</h4>
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c; width: 10px; height: 10px; border-radius: 50%;"></div>
                    <span>üè† Home Residence</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #9b59b6; width: 10px; height: 10px; border-radius: 50%;"></div>
                    <span>üéì Educational Facilities</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #27ae60; width: 20px; height: 3px;"></div>
                    <span>üö∂ Walking Routes</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f39c12; width: 20px; height: 3px;"></div>
                    <span>üó∫Ô∏è District Boundaries</span>
                </div>
                <p style="margin-top: 15px; font-size: 12px; color: #666;">
                    <strong>üí° Tip:</strong> Hover over markers and areas for tooltips. Click for detailed information!
                </p>
            </div>
        </div>
    </div>

    <script>
        // Initialize map
        var map = L.map("map").setView([-6.9053877997992, 106.87356135956009], 15);

        // Base Maps
        var osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        });

        var satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles ¬© Esri ‚Äî Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
            maxZoom: 19
        });

        // Add default base map
        osmLayer.addTo(map);

        // Overlay Layers
        
        // 1. Markers Layer with Enhanced Interactivity
        var markersLayer = L.layerGroup();
        var markerData = [
            {
                lat: -6.905526632682002, 
                lng: 106.87460693244734, 
                title: 'Home Residence',
                icon: 'home',
                tooltip: 'üè† My Home',
                description: 'This is my home residence in Sukabumi. A peaceful neighborhood with easy access to campus and local amenities.',
                details: {
                    type: 'Residential',
                    address: 'Jl. Residence Area, Sukabumi',
                    distance: '200m from campus',
                    amenities: ['Parking', 'Internet', 'Security']
                }
            },
            {
                lat: -6.905371637991479, 
                lng: 106.87354867030655, 
                title: 'NusaPutra University Campus',
                icon: 'school',
                tooltip: 'üéì NusaPutra Campus',
                description: 'NusaPutra University - Main campus building. Offering quality education in various fields including Information Technology.',
                details: {
                    type: 'Educational Institution',
                    address: 'Jl. Raya Cibolang Kaler No.21, Sukabumi',
                    established: '1990',
                    programs: ['IT', 'Engineering', 'Business', 'Design']
                }
            },
            {
                lat: -6.902595997614433, 
                lng: 106.88374813225745, 
                title: 'Vos Bakery',
                icon: 'store',
                tooltip: 'üçû Vos Bakery Shop',
                description: 'Popular local bakery known for fresh bread and pastries. Perfect spot for breakfast or quick snacks.',
                details: {
                    type: 'Food & Beverage',
                    address: 'Jl. Bakery Street, Sukabumi',
                    hours: '06:00 AM - 09:00 PM',
                    specialties: ['Fresh Bread', 'Cakes', 'Pastries', 'Coffee']
                }
            },
            {
                lat: -6.902816971435422, 
                lng: 106.8825460640145, 
                title: 'Emergency Medical Clinic',
                icon: 'hospital',
                tooltip: 'üè• 24/7 Medical Clinic',
                description: 'Emergency medical facility providing 24/7 healthcare services. Equipped with modern medical equipment and experienced staff.',
                details: {
                    type: 'Healthcare Facility',
                    address: 'Jl. Medical Center, Sukabumi',
                    hours: '24/7 Emergency Services',
                    services: ['Emergency Care', 'General Consultation', 'Pharmacy', 'Laboratory']
                }
            },
            {
                lat: -6.9192497, 
                lng: 106.9289142, 
                title: 'Sukabumi City Hall',
                icon: 'government',
                tooltip: 'üèõÔ∏è City Government Office',
                description: 'Sukabumi City Hall - Main administrative building for city government services and public administration.',
                details: {
                    type: 'Government Office',
                    address: 'Jl. Bhayangkara No.10, Sukabumi',
                    hours: 'Mon-Fri: 08:00 AM - 04:00 PM',
                    services: ['Civil Registry', 'Permits', 'Public Services', 'Information Center']
                }
            }
        ];

        // Enhanced Custom marker icons with pulse animation
        var customIcons = {
            home: L.divIcon({className: 'custom-icon home-icon', html: 'üè†', iconSize: [35, 35]}),
            school: L.divIcon({className: 'custom-icon school-icon', html: 'üéì', iconSize: [35, 35]}),
            store: L.divIcon({className: 'custom-icon store-icon', html: 'üçû', iconSize: [35, 35]}),
            hospital: L.divIcon({className: 'custom-icon hospital-icon', html: 'üè•', iconSize: [35, 35]}),
            government: L.divIcon({className: 'custom-icon government-icon', html: 'üèõÔ∏è', iconSize: [35, 35]})
        };

        // Create markers with enhanced popups and tooltips
        markerData.forEach(function(item) {
            // Create detailed popup content with interactive HTML
            var popupContent = `
                <div class="custom-popup">
                    <h3 style="margin: 0 0 10px 0; color: #2c3e50; font-size: 16px; border-bottom: 2px solid #3498db; padding-bottom: 5px;">
                        ${item.title}
                    </h3>
                    <p style="margin: 5px 0; font-size: 13px; color: #555;">
                        ${item.description}
                    </p>
                    <div style="margin-top: 10px; background: #f8f9fa; padding: 10px; border-radius: 5px;">
                        <strong style="color: #2c3e50;">Details:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px; font-size: 12px;">
                            <li><strong>Type:</strong> ${item.details.type}</li>
                            <li><strong>Address:</strong> ${item.details.address}</li>
                            <li><strong>${item.details.hours ? 'Hours' : item.details.established ? 'Established' : item.details.distance ? 'Distance' : 'Info'}:</strong> 
                                ${item.details.hours || item.details.established || item.details.distance || 'N/A'}
                            </li>
                        </ul>
                    </div>
                    ${item.details.amenities || item.details.programs || item.details.specialties || item.details.services ? `
                    <div style="margin-top: 8px;">
                        <strong style="color: #2c3e50; font-size: 12px;">
                            ${item.details.amenities ? 'Amenities' : item.details.programs ? 'Programs' : item.details.specialties ? 'Specialties' : 'Services'}:
                        </strong>
                        <div style="margin-top: 5px;">
                            ${(item.details.amenities || item.details.programs || item.details.specialties || item.details.services).map(function(feature) {
                                return `<span style="display: inline-block; background: #3498db; color: white; padding: 2px 8px; margin: 2px; border-radius: 3px; font-size: 11px;">${feature}</span>`;
                            }).join('')}
                        </div>
                    </div>
                    ` : ''}
                    <div style="margin-top: 10px; padding-top: 8px; border-top: 1px solid #ddd; font-size: 11px; color: #666;">
                        <strong>üìç Coordinates:</strong> ${item.lat.toFixed(6)}, ${item.lng.toFixed(6)}
                        <br>
                        <button onclick="alert('Directions feature coming soon!')" style="margin-top: 5px; background: #27ae60; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 11px;">
                            üó∫Ô∏è Get Directions
                        </button>
                        <button onclick="alert('Added to favorites!')" style="margin-top: 5px; background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; font-size: 11px; margin-left: 5px;">
                            ‚≠ê Add to Favorites
                        </button>
                    </div>
                </div>
            `;

            var marker = L.marker([item.lat, item.lng], {
                icon: customIcons[item.icon] || L.marker().options.icon,
                riseOnHover: true
            })
            .bindPopup(popupContent, {
                maxWidth: 300,
                className: 'custom-popup-container'
            })
            .bindTooltip(item.tooltip, {
                permanent: false,
                direction: 'top',
                offset: [0, -15],
                opacity: 0.9,
                className: 'custom-tooltip'
            });

            // Add interactive events
            marker.on('mouseover', function(e) {
                this.openTooltip();
                // Add pulse effect without interfering with positioning
                if (e.target._icon) {
                    e.target._icon.classList.add('marker-hover');
                }
            });

            marker.on('mouseout', function(e) {
                // Remove pulse effect
                if (e.target._icon) {
                    e.target._icon.classList.remove('marker-hover');
                }
            });

            marker.on('click', function(e) {
                // Zoom to marker on click
                map.setView(e.latlng, 17, {
                    animate: true,
                    duration: 1
                });
                
                // Add click animation
                if (e.target._icon) {
                    e.target._icon.classList.add('marker-bounce');
                    setTimeout(function() {
                        e.target._icon.classList.remove('marker-bounce');
                    }, 500);
                }
            });

            markersLayer.addLayer(marker);
        });

        // 2. Polyline Layer (Walking Routes)
        var polylinesLayer = L.layerGroup();
        
        // Main walking route
        var walkingRoute = [
            [-6.902595997614433, 106.88374813225745], // Vos Bakery
            [-6.9053877997992, 106.87356135956009],   // NusaPutra Campus
            [-6.905526632682002, 106.87460693244734]  // Home
        ];
        
        var mainRoute = L.polyline(walkingRoute, {
            color: '#27ae60',
            weight: 4,
            opacity: 0.8,
            smoothFactor: 1
        }).bindPopup(`
            <div style="font-family: Arial, sans-serif;">
                <h4 style="margin: 0 0 8px 0; color: #27ae60;">üö∂ Main Walking Route</h4>
                <p style="margin: 5px 0; font-size: 13px;"><strong>Route:</strong> Bakery ‚Üí Campus ‚Üí Home</p>
                <p style="margin: 5px 0; font-size: 13px;"><strong>Distance:</strong> ~2.3 km</p>
                <p style="margin: 5px 0; font-size: 13px;"><strong>Est. Time:</strong> 25-30 minutes</p>
                <p style="margin: 5px 0; font-size: 12px; color: #666;">This is my daily commute route through Sukabumi.</p>
            </div>
        `).bindTooltip('üö∂ Daily Walking Route', {
            sticky: true
        });
        
        // Add hover effects to route
        mainRoute.on('mouseover', function(e) {
            this.setStyle({
                weight: 6,
                opacity: 1
            });
        });
        
        mainRoute.on('mouseout', function(e) {
            this.setStyle({
                weight: 4,
                opacity: 0.8
            });
        });
        
        // Secondary route (to City Hall)
        var secondaryRoute = [
            [-6.905526632682002, 106.87460693244734], // Home
            [-6.910000, 106.890000],                   // Intermediate point
            [-6.9192497, 106.9289142]                  // City Hall
        ];
        
        var cityRoute = L.polyline(secondaryRoute, {
            color: '#3498db',
            weight: 3,
            opacity: 0.7,
            dashArray: '10, 10',
            smoothFactor: 1
        }).bindPopup(`
            <div style="font-family: Arial, sans-serif;">
                <h4 style="margin: 0 0 8px 0; color: #3498db;">üèõÔ∏è Route to City Hall</h4>
                <p style="margin: 5px 0; font-size: 13px;"><strong>Route:</strong> Home ‚Üí City Hall</p>
                <p style="margin: 5px 0; font-size: 13px;"><strong>Distance:</strong> ~3.8 km</p>
                <p style="margin: 5px 0; font-size: 13px;"><strong>Est. Time:</strong> 40-45 minutes</p>
                <p style="margin: 5px 0; font-size: 12px; color: #666;">Occasional route for administrative tasks.</p>
            </div>
        `).bindTooltip('üèõÔ∏è City Hall Route', {
            sticky: true
        });
        
        cityRoute.on('mouseover', function(e) {
            this.setStyle({
                weight: 5,
                opacity: 1
            });
        });
        
        cityRoute.on('mouseout', function(e) {
            this.setStyle({
                weight: 3,
                opacity: 0.7
            });
        });
        
        polylinesLayer.addLayer(mainRoute);
        polylinesLayer.addLayer(cityRoute);

        // 3. Polygon Layer (Areas)
        var polygonsLayer = L.layerGroup();
        
        // Campus area
        var campusArea = [
            [-6.905521677411528, 106.87383568225783],
            [-6.904833465852192, 106.87372693873033], 
            [-6.9047659940766835, 106.87320134501283], 
            [-6.905616137743223, 106.87317415913208] 
        ];
        
        var campusPolygon = L.polygon(campusArea, {
            color: '#9b59b6',
            fillColor: '#e8d5f2',
            fillOpacity: 0.5,
            weight: 2
        }).bindPopup(`
            <div style="font-family: Arial, sans-serif;">
                <h4 style="margin: 0 0 8px 0; color: #9b59b6;">üéì NusaPutra Campus Area</h4>
                <p style="margin: 5px 0; font-size: 13px;">Main university campus with multiple buildings and facilities.</p>
                <div style="margin-top: 8px; background: #f8f9fa; padding: 8px; border-radius: 5px;">
                    <p style="margin: 3px 0; font-size: 12px;"><strong>Area:</strong> ~15,000 m¬≤</p>
                    <p style="margin: 3px 0; font-size: 12px;"><strong>Buildings:</strong> 5 main buildings</p>
                    <p style="margin: 3px 0; font-size: 12px;"><strong>Facilities:</strong> Library, Labs, Cafeteria</p>
                </div>
            </div>
        `).bindTooltip('üéì Campus Area', {
            sticky: true
        });
        
        // Add hover effects
        campusPolygon.on('mouseover', function(e) {
            this.setStyle({
                fillOpacity: 0.7,
                weight: 3
            });
        });
        
        campusPolygon.on('mouseout', function(e) {
            this.setStyle({
                fillOpacity: 0.5,
                weight: 2
            });
        });
        
        // Residential area
        var residentialArea = [
            [-6.904500, 106.873000],
            [-6.904000, 106.874000],
            [-6.905000, 106.875000],
            [-6.905500, 106.874000]
        ];
        
        var residentialPolygon = L.polygon(residentialArea, {
            color: '#e67e22',
            fillColor: '#f8e6d3',
            fillOpacity: 0.4,
            weight: 2
        }).bindPopup(`
            <div style="font-family: Arial, sans-serif;">
                <h4 style="margin: 0 0 8px 0; color: #e67e22;">üèòÔ∏è Residential Area</h4>
                <p style="margin: 5px 0; font-size: 13px;">Peaceful neighborhood with family homes and local amenities.</p>
                <div style="margin-top: 8px; background: #f8f9fa; padding: 8px; border-radius: 5px;">
                    <p style="margin: 3px 0; font-size: 12px;"><strong>Type:</strong> Mixed residential</p>
                    <p style="margin: 3px 0; font-size: 12px;"><strong>Population:</strong> ~5,000 residents</p>
                    <p style="margin: 3px 0; font-size: 12px;"><strong>Amenities:</strong> Schools, Parks, Shops</p>
                </div>
            </div>
        `).bindTooltip('üèòÔ∏è Residential Area', {
            sticky: true
        });
        
        residentialPolygon.on('mouseover', function(e) {
            this.setStyle({
                fillOpacity: 0.6,
                weight: 3
            });
        });
        
        residentialPolygon.on('mouseout', function(e) {
            this.setStyle({
                fillOpacity: 0.4,
                weight: 2
            });
        });
        
        polygonsLayer.addLayer(campusPolygon);
        polygonsLayer.addLayer(residentialPolygon);

        // Enhanced GeoJSON data with Sukabumi district boundaries
        var sukabumiBoundaries = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "properties": {
                        "name": "Sukabumi Kabupaten District",
                        "type": "district",
                        "population": "350000"
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [[
                            [106.860000, -6.890000],
                            [106.890000, -6.890000],
                            [106.890000, -6.920000],
                            [106.860000, -6.920000],
                            [106.860000, -6.890000]
                        ]]
                    }
                },
                {
                    "type": "Feature",
                    "properties": {
                        "name": "Gunungpuyuh Subdistrict",
                        "type": "subdistrict"
                    },
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [[
                            [106.870000, -6.900000],
                            [106.885000, -6.900000],
                            [106.885000, -6.910000],
                            [106.870000, -6.910000],
                            [106.870000, -6.900000]
                        ]]
                    }
                }
            ]
        };

        // Add GeoJSON layer with enhanced interactivity
        var geoJsonLayer = L.geoJSON(sukabumiBoundaries, {
            style: function(feature) {
                if (feature.geometry.type === 'Polygon') {
                    return {
                        color: '#f39c12',
                        weight: 2,
                        opacity: 0.8,
                        fillColor: '#f9e79f',
                        fillOpacity: 0.3
                    };
                }
            },
            onEachFeature: function(feature, layer) {
                if (feature.properties && feature.properties.name) {
                    // Enhanced popup content with HTML styling
                    var popupContent = `
                        <div style="font-family: Arial, sans-serif;">
                            <h4 style="margin: 0 0 8px 0; color: #f39c12;">${feature.properties.name}</h4>
                            <div style="background: #f8f9fa; padding: 8px; border-radius: 5px;">
                                ${feature.properties.type ? `<p style="margin: 3px 0; font-size: 12px;"><strong>Type:</strong> ${feature.properties.type}</p>` : ''}
                                ${feature.properties.population ? `<p style="margin: 3px 0; font-size: 12px;"><strong>Population:</strong> ${feature.properties.population}</p>` : ''}
                            </div>
                        </div>
                    `;
                    
                    layer.bindPopup(popupContent);
                    layer.bindTooltip(feature.properties.name, {
                        sticky: true,
                        className: 'custom-tooltip'
                    });
                    
                    // Add hover effects for polygons
                    if (feature.geometry.type === 'Polygon') {
                        layer.on('mouseover', function(e) {
                            this.setStyle({
                                fillOpacity: 0.5,
                                weight: 3
                            });
                        });
                        
                        layer.on('mouseout', function(e) {
                            this.setStyle({
                                fillOpacity: 0.3,
                                weight: 2
                            });
                        });
                    }
                }
            }
        });

        // Base Maps object
        var baseMaps = {
            "üó∫Ô∏è OpenStreetMap": osmLayer,
            "üõ∞Ô∏è Satellite": satelliteLayer
        };

        // Overlay Maps object
        var overlayMaps = {
            "üìç Markers": markersLayer,
            "üõ§Ô∏è Routes": polylinesLayer,
            "üèòÔ∏è Areas": polygonsLayer,
            "üó∫Ô∏è Districts": geoJsonLayer
        };

        // Add layers to map by default
        markersLayer.addTo(map);
        polylinesLayer.addTo(map);
        polygonsLayer.addTo(map);
        geoJsonLayer.addTo(map);

        // Layer Control
        var layerControl = L.control.layers(baseMaps, overlayMaps, {
            position: 'topright',
            collapsed: false
        }).addTo(map);

        // Scale Control
        L.control.scale({
            position: 'bottomright'
        }).addTo(map);

        // Coordinate display on click
        var coordsDiv = document.getElementById('coordinates');
        map.on('click', function(e) {
            var lat = e.latlng.lat.toFixed(6);
            var lng = e.latlng.lng.toFixed(6);
            coordsDiv.innerHTML = `üìç Coordinates: ${lat}, ${lng}`;
        });

        // Custom CSS for icons and animations
        var style = document.createElement('style');
        style.textContent = `
            .custom-icon {
                background: white;
                border-radius: 50%;
                border: 2px solid #333;
                text-align: center;
                line-height: 30px;
                font-size: 18px;
                box-shadow: 0 3px 8px rgba(0,0,0,0.3);
                cursor: pointer;
                /* Remove transition from base to avoid conflicts */
            }
            
            .marker-hover {
                box-shadow: 0 5px 15px rgba(0,0,0,0.5) !important;
                /* Simple scale without infinite animation - stops blipping */
                transform: scale(1.1) !important;
                transition: transform 0.2s ease, box-shadow 0.2s ease !important;
            }
            
            .marker-bounce {
                animation: bounce 0.5s ease !important;
            }
            
            .home-icon {
                border-color: #e74c3c;
                background: linear-gradient(135deg, #fff, #ffecec);
            }
            
            .school-icon {
                border-color: #9b59b6;
                background: linear-gradient(135deg, #fff, #f3e9ff);
            }
            
            .store-icon {
                border-color: #f39c12;
                background: linear-gradient(135deg, #fff, #fff4e6);
            }
            
            .hospital-icon {
                border-color: #27ae60;
                background: linear-gradient(135deg, #fff, #e8f8f5);
            }
            
            .government-icon {
                border-color: #3498db;
                background: linear-gradient(135deg, #fff, #ebf5fb);
            }
            
            @keyframes bounce {
                0%, 20%, 50%, 80%, 100% { 
                    transform: translateY(0); 
                }
                40% { 
                    transform: translateY(-15px); 
                }
                60% { 
                    transform: translateY(-7px); 
                }
            }
            
            /* Removed problematic pulse animation with translateX */
            
            .leaflet-control-layers {
                max-height: 400px;
                overflow-y: auto;
                background: white;
                border-radius: 8px;
                box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            }
            
            .leaflet-control-layers-expanded {
                padding: 10px;
            }
            
            .custom-popup-container .leaflet-popup-content-wrapper {
                border-radius: 8px;
                box-shadow: 0 3px 15px rgba(0,0,0,0.3);
            }
            
            .custom-popup-container .leaflet-popup-content {
                margin: 15px;
                font-size: 14px;
                line-height: 1.5;
            }
            
            .custom-tooltip {
                background: rgba(44, 62, 80, 0.9);
                border: none;
                border-radius: 4px;
                color: white;
                font-weight: bold;
                padding: 5px 10px;
                font-size: 12px;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            }
            
            .custom-popup button {
                transition: all 0.3s ease;
            }
            
            .custom-popup button:hover {
                transform: translateY(-2px);
                box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            }
            
            .custom-popup button:active {
                transform: translateY(0);
            }
            
            /* Additional fix for Leaflet marker positioning */
            .leaflet-marker-icon.custom-icon {
                margin-left: -17.5px !important;
                margin-top: -17.5px !important;
            }
        `;
        document.head.appendChild(style);

        // Fit map to show all features
        var group = new L.featureGroup([markersLayer, polylinesLayer, polygonsLayer, geoJsonLayer]);
        map.fitBounds(group.getBounds().pad(0.1));
    </script>
</body>
</html>